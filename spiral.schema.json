{
	"$schema": "https://json-schema.org/draft/2020-12/schema",
	"$id": "https://raw.githubusercontent.com/Mearman/SPIRAL/refs/heads/main/spiral.schema.json",
	"$defs": {
		"AIRDef": {
			"type": "object",
			"properties": {
				"body": {
					"anyOf": [
						{
							"$ref": "#/$defs/LitExpr"
						},
						{
							"$ref": "#/$defs/RefExpr"
						},
						{
							"$ref": "#/$defs/VarExpr"
						},
						{
							"$ref": "#/$defs/CallExpr"
						},
						{
							"$ref": "#/$defs/IfExpr"
						},
						{
							"$ref": "#/$defs/LetExpr"
						},
						{
							"$ref": "#/$defs/AirRefExpr"
						},
						{
							"$ref": "#/$defs/PredicateExpr"
						}
					]
				},
				"name": {
					"type": "string"
				},
				"ns": {
					"type": "string"
				},
				"params": {
					"type": "array",
					"items": {
						"type": "string"
					}
				},
				"result": {
					"$ref": "#/$defs/Type"
				}
			},
			"additionalProperties": false,
			"required": [
				"ns",
				"name",
				"params",
				"result",
				"body"
			],
			"id": "AIRDef"
		},
		"AirRefExpr": {
			"type": "object",
			"properties": {
				"args": {
					"type": "array",
					"items": {
						"type": "string"
					}
				},
				"kind": {
					"type": "string",
					"const": "airRef"
				},
				"name": {
					"type": "string"
				},
				"ns": {
					"type": "string"
				}
			},
			"additionalProperties": false,
			"required": [
				"kind",
				"ns",
				"name",
				"args"
			],
			"id": "AirRefExpr"
		},
		"CallExpr": {
			"type": "object",
			"properties": {
				"args": {
					"type": "array",
					"items": {
						"anyOf": [
							{
								"type": "string"
							},
							{
								"$ref": "#/$defs/Expr"
							}
						]
					}
				},
				"kind": {
					"type": "string",
					"const": "call"
				},
				"name": {
					"type": "string"
				},
				"ns": {
					"type": "string"
				}
			},
			"additionalProperties": false,
			"required": [
				"kind",
				"ns",
				"name",
				"args"
			],
			"id": "CallExpr"
		},
		"Expr": {
			"anyOf": [
				{
					"$ref": "#/$defs/LitExpr"
				},
				{
					"$ref": "#/$defs/RefExpr"
				},
				{
					"$ref": "#/$defs/VarExpr"
				},
				{
					"$ref": "#/$defs/CallExpr"
				},
				{
					"$ref": "#/$defs/IfExpr"
				},
				{
					"$ref": "#/$defs/LetExpr"
				},
				{
					"$ref": "#/$defs/AirRefExpr"
				},
				{
					"$ref": "#/$defs/PredicateExpr"
				},
				{
					"type": "object",
					"properties": {
						"type": {
							"$ref": "#/$defs/Type"
						},
						"body": {
							"type": "string"
						},
						"kind": {
							"type": "string",
							"const": "lambda"
						},
						"params": {
							"type": "array",
							"items": {
								"anyOf": [
									{
										"type": "string"
									},
									{
										"type": "object",
										"properties": {
											"type": {
												"$ref": "#/$defs/Type"
											},
											"default": {
												"$ref": "#/$defs/Expr"
											},
											"name": {
												"type": "string"
											},
											"optional": {
												"type": "boolean"
											}
										},
										"additionalProperties": false,
										"required": [
											"name"
										]
									}
								]
							}
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"params",
						"body",
						"type"
					]
				},
				{
					"type": "object",
					"properties": {
						"args": {
							"type": "array",
							"items": {
								"anyOf": [
									{
										"type": "string"
									},
									{
										"$ref": "#/$defs/Expr"
									}
								]
							}
						},
						"fn": {
							"type": "string"
						},
						"kind": {
							"type": "string",
							"const": "callExpr"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"fn",
						"args"
					]
				},
				{
					"type": "object",
					"properties": {
						"type": {
							"$ref": "#/$defs/Type"
						},
						"fn": {
							"type": "string"
						},
						"kind": {
							"type": "string",
							"const": "fix"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"fn",
						"type"
					]
				},
				{
					"type": "object",
					"properties": {
						"exprs": {
							"type": "array",
							"items": {
								"anyOf": [
									{
										"type": "string"
									},
									{
										"$ref": "#/$defs/Expr"
									}
								]
							}
						},
						"kind": {
							"type": "string",
							"const": "do"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"exprs"
					]
				}
			],
			"id": "Expr"
		},
		"FunctionSignature": {
			"type": "object",
			"properties": {
				"name": {
					"type": "string"
				},
				"ns": {
					"type": "string"
				},
				"params": {
					"type": "array",
					"items": {
						"$ref": "#/$defs/Type"
					}
				},
				"pure": {
					"type": "boolean"
				},
				"returns": {
					"$ref": "#/$defs/Type"
				}
			},
			"additionalProperties": false,
			"required": [
				"ns",
				"name",
				"params",
				"returns",
				"pure"
			],
			"id": "FunctionSignature"
		},
		"IfExpr": {
			"type": "object",
			"properties": {
				"type": {
					"$ref": "#/$defs/Type"
				},
				"then": {
					"anyOf": [
						{
							"type": "string"
						},
						{
							"$ref": "#/$defs/Expr"
						}
					]
				},
				"else": {
					"anyOf": [
						{
							"type": "string"
						},
						{
							"$ref": "#/$defs/Expr"
						}
					]
				},
				"cond": {
					"anyOf": [
						{
							"type": "string"
						},
						{
							"$ref": "#/$defs/Expr"
						}
					]
				},
				"kind": {
					"type": "string",
					"const": "if"
				}
			},
			"additionalProperties": false,
			"required": [
				"kind",
				"cond",
				"then",
				"else"
			],
			"id": "IfExpr"
		},
		"LetExpr": {
			"type": "object",
			"properties": {
				"type": {
					"$ref": "#/$defs/Type"
				},
				"body": {
					"anyOf": [
						{
							"type": "string"
						},
						{
							"$ref": "#/$defs/Expr"
						}
					]
				},
				"kind": {
					"type": "string",
					"const": "let"
				},
				"name": {
					"type": "string"
				},
				"value": {
					"anyOf": [
						{
							"type": "string"
						},
						{
							"$ref": "#/$defs/Expr"
						}
					]
				}
			},
			"additionalProperties": false,
			"required": [
				"kind",
				"name",
				"value",
				"body"
			],
			"id": "LetExpr"
		},
		"LirInsPhi": {
			"type": "object",
			"properties": {
				"kind": {
					"type": "string",
					"const": "phi"
				},
				"sources": {
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"block": {
								"type": "string"
							},
							"id": {
								"type": "string"
							}
						},
						"additionalProperties": false,
						"required": [
							"block",
							"id"
						]
					}
				},
				"target": {
					"type": "string"
				}
			},
			"additionalProperties": false,
			"required": [
				"kind",
				"target",
				"sources"
			],
			"id": "LirInsPhi"
		},
		"LirTermBranch": {
			"type": "object",
			"properties": {
				"cond": {
					"type": "string"
				},
				"else": {
					"type": "string"
				},
				"kind": {
					"type": "string",
					"const": "branch"
				},
				"then": {
					"type": "string"
				}
			},
			"additionalProperties": false,
			"required": [
				"kind",
				"cond",
				"then",
				"else"
			],
			"id": "LirTermBranch"
		},
		"LirTermExit": {
			"type": "object",
			"properties": {
				"code": {
					"anyOf": [
						{
							"type": "string"
						},
						{
							"type": "number"
						}
					]
				},
				"kind": {
					"type": "string",
					"const": "exit"
				}
			},
			"additionalProperties": false,
			"required": [
				"kind"
			],
			"id": "LirTermExit"
		},
		"LirTermJump": {
			"type": "object",
			"properties": {
				"kind": {
					"type": "string",
					"const": "jump"
				},
				"to": {
					"type": "string"
				}
			},
			"additionalProperties": false,
			"required": [
				"kind",
				"to"
			],
			"id": "LirTermJump"
		},
		"LirTermReturn": {
			"type": "object",
			"properties": {
				"kind": {
					"type": "string",
					"const": "return"
				},
				"value": {
					"type": "string"
				}
			},
			"additionalProperties": false,
			"required": [
				"kind"
			],
			"id": "LirTermReturn"
		},
		"LitExpr": {
			"type": "object",
			"properties": {
				"type": {
					"$ref": "#/$defs/Type"
				},
				"kind": {
					"type": "string",
					"const": "lit"
				},
				"value": {}
			},
			"additionalProperties": false,
			"required": [
				"kind",
				"type",
				"value"
			],
			"id": "LitExpr"
		},
		"PredicateExpr": {
			"type": "object",
			"properties": {
				"kind": {
					"type": "string",
					"const": "predicate"
				},
				"name": {
					"type": "string"
				},
				"value": {
					"type": "string"
				}
			},
			"additionalProperties": false,
			"required": [
				"kind",
				"name",
				"value"
			],
			"id": "PredicateExpr"
		},
		"RefExpr": {
			"type": "object",
			"properties": {
				"id": {
					"type": "string"
				},
				"kind": {
					"type": "string",
					"const": "ref"
				}
			},
			"additionalProperties": false,
			"required": [
				"kind",
				"id"
			],
			"id": "RefExpr"
		},
		"Type": {
			"anyOf": [
				{
					"type": "object",
					"properties": {
						"kind": {
							"type": "string",
							"const": "bool"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind"
					]
				},
				{
					"type": "object",
					"properties": {
						"kind": {
							"type": "string",
							"const": "int"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind"
					]
				},
				{
					"type": "object",
					"properties": {
						"kind": {
							"type": "string",
							"const": "float"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind"
					]
				},
				{
					"type": "object",
					"properties": {
						"kind": {
							"type": "string",
							"const": "string"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind"
					]
				},
				{
					"type": "object",
					"properties": {
						"kind": {
							"type": "string",
							"const": "void"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind"
					]
				},
				{
					"type": "object",
					"properties": {
						"kind": {
							"type": "string",
							"const": "set"
						},
						"of": {
							"$ref": "#/$defs/Type"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"of"
					]
				},
				{
					"type": "object",
					"properties": {
						"kind": {
							"type": "string",
							"const": "list"
						},
						"of": {
							"$ref": "#/$defs/Type"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"of"
					]
				},
				{
					"type": "object",
					"properties": {
						"key": {
							"$ref": "#/$defs/Type"
						},
						"kind": {
							"type": "string",
							"const": "map"
						},
						"value": {
							"$ref": "#/$defs/Type"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"key",
						"value"
					]
				},
				{
					"type": "object",
					"properties": {
						"kind": {
							"type": "string",
							"const": "option"
						},
						"of": {
							"$ref": "#/$defs/Type"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"of"
					]
				},
				{
					"type": "object",
					"properties": {
						"kind": {
							"type": "string",
							"const": "opaque"
						},
						"name": {
							"type": "string"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"name"
					]
				},
				{
					"type": "object",
					"properties": {
						"kind": {
							"type": "string",
							"const": "fn"
						},
						"optionalParams": {
							"type": "array",
							"items": {
								"type": "boolean"
							}
						},
						"params": {
							"type": "array",
							"items": {
								"$ref": "#/$defs/Type"
							}
						},
						"returns": {
							"$ref": "#/$defs/Type"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"params",
						"returns"
					]
				},
				{
					"type": "object",
					"properties": {
						"kind": {
							"type": "string",
							"const": "ref"
						},
						"of": {
							"$ref": "#/$defs/Type"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"of"
					]
				},
				{
					"type": "object",
					"properties": {
						"kind": {
							"type": "string",
							"const": "future"
						},
						"of": {
							"$ref": "#/$defs/Type"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"of"
					]
				},
				{
					"type": "object",
					"properties": {
						"channelType": {
							"type": "string",
							"enum": [
								"mpsc",
								"spsc",
								"mpmc",
								"broadcast"
							]
						},
						"kind": {
							"type": "string",
							"const": "channel"
						},
						"of": {
							"$ref": "#/$defs/Type"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"channelType",
						"of"
					]
				},
				{
					"type": "object",
					"properties": {
						"kind": {
							"type": "string",
							"const": "task"
						},
						"returns": {
							"$ref": "#/$defs/Type"
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"returns"
					]
				},
				{
					"type": "object",
					"properties": {
						"kind": {
							"type": "string",
							"const": "async"
						},
						"params": {
							"type": "array",
							"items": {
								"$ref": "#/$defs/Type"
							}
						},
						"returns": {
							"type": "object",
							"properties": {
								"kind": {
									"type": "string",
									"const": "future"
								},
								"of": {
									"$ref": "#/$defs/Type"
								}
							},
							"additionalProperties": false,
							"required": [
								"kind",
								"of"
							]
						}
					},
					"additionalProperties": false,
					"required": [
						"kind",
						"params",
						"returns"
					]
				}
			],
			"id": "Type"
		},
		"VarExpr": {
			"type": "object",
			"properties": {
				"kind": {
					"type": "string",
					"const": "var"
				},
				"name": {
					"type": "string"
				}
			},
			"additionalProperties": false,
			"required": [
				"kind",
				"name"
			],
			"id": "VarExpr"
		}
	},
	"title": "SPIRAL Document",
	"description": "SPIRALDocument",
	"anyOf": [
		{
			"description": "AIRDocument",
			"type": "object",
			"properties": {
				"airDefs": {
					"type": "array",
					"items": {
						"$ref": "#/$defs/AIRDef"
					}
				},
				"capabilities": {
					"type": "array",
					"items": {
						"type": "string"
					}
				},
				"functionSigs": {
					"type": "array",
					"items": {
						"$ref": "#/$defs/FunctionSignature"
					}
				},
				"nodes": {
					"type": "array",
					"items": {
						"anyOf": [
							{
								"type": "object",
								"properties": {
									"type": {
										"$ref": "#/$defs/Type"
									},
									"expr": {
										"anyOf": [
											{
												"$ref": "#/$defs/LitExpr"
											},
											{
												"$ref": "#/$defs/RefExpr"
											},
											{
												"$ref": "#/$defs/VarExpr"
											},
											{
												"$ref": "#/$defs/CallExpr"
											},
											{
												"$ref": "#/$defs/IfExpr"
											},
											{
												"$ref": "#/$defs/LetExpr"
											},
											{
												"$ref": "#/$defs/AirRefExpr"
											},
											{
												"$ref": "#/$defs/PredicateExpr"
											}
										]
									},
									"id": {
										"type": "string"
									}
								},
								"additionalProperties": false,
								"required": [
									"id",
									"expr"
								]
							},
							{
								"type": "object",
								"properties": {
									"type": {
										"$ref": "#/$defs/Type"
									},
									"blocks": {
										"type": "array",
										"items": {
											"type": "object",
											"properties": {
												"id": {
													"type": "string"
												},
												"instructions": {
													"type": "array",
													"items": {
														"anyOf": [
															{
																"type": "object",
																"properties": {
																	"kind": {
																		"type": "string",
																		"const": "assign"
																	},
																	"target": {
																		"type": "string"
																	},
																	"value": {
																		"anyOf": [
																			{
																				"$ref": "#/$defs/LitExpr"
																			},
																			{
																				"$ref": "#/$defs/RefExpr"
																			},
																			{
																				"$ref": "#/$defs/VarExpr"
																			},
																			{
																				"$ref": "#/$defs/CallExpr"
																			},
																			{
																				"$ref": "#/$defs/IfExpr"
																			},
																			{
																				"$ref": "#/$defs/LetExpr"
																			},
																			{
																				"$ref": "#/$defs/AirRefExpr"
																			},
																			{
																				"$ref": "#/$defs/PredicateExpr"
																			}
																		]
																	}
																},
																"additionalProperties": false,
																"required": [
																	"kind",
																	"target",
																	"value"
																]
															},
															{
																"type": "object",
																"properties": {
																	"args": {
																		"type": "array",
																		"items": {
																			"type": "string"
																		}
																	},
																	"kind": {
																		"type": "string",
																		"const": "op"
																	},
																	"name": {
																		"type": "string"
																	},
																	"ns": {
																		"type": "string"
																	},
																	"target": {
																		"type": "string"
																	}
																},
																"additionalProperties": false,
																"required": [
																	"kind",
																	"target",
																	"ns",
																	"name",
																	"args"
																]
															},
															{
																"$ref": "#/$defs/LirInsPhi"
															}
														]
													}
												},
												"terminator": {
													"anyOf": [
														{
															"$ref": "#/$defs/LirTermJump"
														},
														{
															"$ref": "#/$defs/LirTermBranch"
														},
														{
															"$ref": "#/$defs/LirTermReturn"
														},
														{
															"$ref": "#/$defs/LirTermExit"
														}
													]
												}
											},
											"additionalProperties": false,
											"required": [
												"id",
												"instructions",
												"terminator"
											]
										}
									},
									"entry": {
										"type": "string"
									},
									"id": {
										"type": "string"
									}
								},
								"additionalProperties": false,
								"required": [
									"id",
									"blocks",
									"entry"
								]
							}
						]
					}
				},
				"result": {
					"type": "string"
				},
				"version": {
					"type": "string",
					"pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$"
				}
			},
			"additionalProperties": false,
			"required": [
				"version",
				"airDefs",
				"nodes",
				"result"
			]
		},
		{
			"description": "CIRDocument",
			"type": "object",
			"properties": {
				"airDefs": {
					"type": "array",
					"items": {
						"$ref": "#/$defs/AIRDef"
					}
				},
				"capabilities": {
					"type": "array",
					"items": {
						"type": "string"
					}
				},
				"functionSigs": {
					"type": "array",
					"items": {
						"$ref": "#/$defs/FunctionSignature"
					}
				},
				"nodes": {
					"type": "array",
					"items": {
						"anyOf": [
							{
								"type": "object",
								"properties": {
									"type": {
										"$ref": "#/$defs/Type"
									},
									"expr": {
										"anyOf": [
											{
												"$ref": "#/$defs/LitExpr"
											},
											{
												"$ref": "#/$defs/RefExpr"
											},
											{
												"$ref": "#/$defs/VarExpr"
											},
											{
												"$ref": "#/$defs/CallExpr"
											},
											{
												"$ref": "#/$defs/IfExpr"
											},
											{
												"$ref": "#/$defs/LetExpr"
											},
											{
												"$ref": "#/$defs/AirRefExpr"
											},
											{
												"$ref": "#/$defs/PredicateExpr"
											},
											{
												"type": "object",
												"properties": {
													"type": {
														"$ref": "#/$defs/Type"
													},
													"body": {
														"type": "string"
													},
													"kind": {
														"type": "string",
														"const": "lambda"
													},
													"params": {
														"type": "array",
														"items": {
															"anyOf": [
																{
																	"type": "string"
																},
																{
																	"type": "object",
																	"properties": {
																		"type": {
																			"$ref": "#/$defs/Type"
																		},
																		"default": {
																			"$ref": "#/$defs/Expr"
																		},
																		"name": {
																			"type": "string"
																		},
																		"optional": {
																			"type": "boolean"
																		}
																	},
																	"additionalProperties": false,
																	"required": [
																		"name"
																	]
																}
															]
														}
													}
												},
												"additionalProperties": false,
												"required": [
													"kind",
													"params",
													"body",
													"type"
												]
											},
											{
												"type": "object",
												"properties": {
													"args": {
														"type": "array",
														"items": {
															"anyOf": [
																{
																	"type": "string"
																},
																{
																	"$ref": "#/$defs/Expr"
																}
															]
														}
													},
													"fn": {
														"type": "string"
													},
													"kind": {
														"type": "string",
														"const": "callExpr"
													}
												},
												"additionalProperties": false,
												"required": [
													"kind",
													"fn",
													"args"
												]
											},
											{
												"type": "object",
												"properties": {
													"type": {
														"$ref": "#/$defs/Type"
													},
													"fn": {
														"type": "string"
													},
													"kind": {
														"type": "string",
														"const": "fix"
													}
												},
												"additionalProperties": false,
												"required": [
													"kind",
													"fn",
													"type"
												]
											},
											{
												"type": "object",
												"properties": {
													"exprs": {
														"type": "array",
														"items": {
															"anyOf": [
																{
																	"type": "string"
																},
																{
																	"$ref": "#/$defs/Expr"
																}
															]
														}
													},
													"kind": {
														"type": "string",
														"const": "do"
													}
												},
												"additionalProperties": false,
												"required": [
													"kind",
													"exprs"
												]
											}
										]
									},
									"id": {
										"type": "string"
									}
								},
								"additionalProperties": false,
								"required": [
									"id",
									"expr"
								]
							},
							{
								"type": "object",
								"properties": {
									"type": {
										"$ref": "#/$defs/Type"
									},
									"blocks": {
										"type": "array",
										"items": {
											"type": "object",
											"properties": {
												"id": {
													"type": "string"
												},
												"instructions": {
													"type": "array",
													"items": {
														"anyOf": [
															{
																"type": "object",
																"properties": {
																	"kind": {
																		"type": "string",
																		"const": "assign"
																	},
																	"target": {
																		"type": "string"
																	},
																	"value": {
																		"anyOf": [
																			{
																				"$ref": "#/$defs/LitExpr"
																			},
																			{
																				"$ref": "#/$defs/RefExpr"
																			},
																			{
																				"$ref": "#/$defs/VarExpr"
																			},
																			{
																				"$ref": "#/$defs/CallExpr"
																			},
																			{
																				"$ref": "#/$defs/IfExpr"
																			},
																			{
																				"$ref": "#/$defs/LetExpr"
																			},
																			{
																				"$ref": "#/$defs/AirRefExpr"
																			},
																			{
																				"$ref": "#/$defs/PredicateExpr"
																			},
																			{
																				"type": "object",
																				"properties": {
																					"type": {
																						"$ref": "#/$defs/Type"
																					},
																					"body": {
																						"type": "string"
																					},
																					"kind": {
																						"type": "string",
																						"const": "lambda"
																					},
																					"params": {
																						"type": "array",
																						"items": {
																							"anyOf": [
																								{
																									"type": "string"
																								},
																								{
																									"type": "object",
																									"properties": {
																										"type": {
																											"$ref": "#/$defs/Type"
																										},
																										"default": {
																											"$ref": "#/$defs/Expr"
																										},
																										"name": {
																											"type": "string"
																										},
																										"optional": {
																											"type": "boolean"
																										}
																									},
																									"additionalProperties": false,
																									"required": [
																										"name"
																									]
																								}
																							]
																						}
																					}
																				},
																				"additionalProperties": false,
																				"required": [
																					"kind",
																					"params",
																					"body",
																					"type"
																				]
																			},
																			{
																				"type": "object",
																				"properties": {
																					"args": {
																						"type": "array",
																						"items": {
																							"anyOf": [
																								{
																									"type": "string"
																								},
																								{
																									"$ref": "#/$defs/Expr"
																								}
																							]
																						}
																					},
																					"fn": {
																						"type": "string"
																					},
																					"kind": {
																						"type": "string",
																						"const": "callExpr"
																					}
																				},
																				"additionalProperties": false,
																				"required": [
																					"kind",
																					"fn",
																					"args"
																				]
																			},
																			{
																				"type": "object",
																				"properties": {
																					"type": {
																						"$ref": "#/$defs/Type"
																					},
																					"fn": {
																						"type": "string"
																					},
																					"kind": {
																						"type": "string",
																						"const": "fix"
																					}
																				},
																				"additionalProperties": false,
																				"required": [
																					"kind",
																					"fn",
																					"type"
																				]
																			},
																			{
																				"type": "object",
																				"properties": {
																					"exprs": {
																						"type": "array",
																						"items": {
																							"anyOf": [
																								{
																									"type": "string"
																								},
																								{
																									"$ref": "#/$defs/Expr"
																								}
																							]
																						}
																					},
																					"kind": {
																						"type": "string",
																						"const": "do"
																					}
																				},
																				"additionalProperties": false,
																				"required": [
																					"kind",
																					"exprs"
																				]
																			}
																		]
																	}
																},
																"additionalProperties": false,
																"required": [
																	"kind",
																	"target",
																	"value"
																]
															},
															{
																"type": "object",
																"properties": {
																	"args": {
																		"type": "array",
																		"items": {
																			"type": "string"
																		}
																	},
																	"kind": {
																		"type": "string",
																		"const": "op"
																	},
																	"name": {
																		"type": "string"
																	},
																	"ns": {
																		"type": "string"
																	},
																	"target": {
																		"type": "string"
																	}
																},
																"additionalProperties": false,
																"required": [
																	"kind",
																	"target",
																	"ns",
																	"name",
																	"args"
																]
															},
															{
																"$ref": "#/$defs/LirInsPhi"
															}
														]
													}
												},
												"terminator": {
													"anyOf": [
														{
															"$ref": "#/$defs/LirTermJump"
														},
														{
															"$ref": "#/$defs/LirTermBranch"
														},
														{
															"$ref": "#/$defs/LirTermReturn"
														},
														{
															"$ref": "#/$defs/LirTermExit"
														}
													]
												}
											},
											"additionalProperties": false,
											"required": [
												"id",
												"instructions",
												"terminator"
											]
										}
									},
									"entry": {
										"type": "string"
									},
									"id": {
										"type": "string"
									}
								},
								"additionalProperties": false,
								"required": [
									"id",
									"blocks",
									"entry"
								]
							}
						]
					}
				},
				"result": {
					"type": "string"
				},
				"version": {
					"type": "string",
					"pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$"
				}
			},
			"additionalProperties": false,
			"required": [
				"version",
				"airDefs",
				"nodes",
				"result"
			]
		},
		{
			"description": "EIRDocument",
			"type": "object",
			"properties": {
				"airDefs": {
					"type": "array",
					"items": {
						"$ref": "#/$defs/AIRDef"
					}
				},
				"capabilities": {
					"type": "array",
					"items": {
						"type": "string"
					}
				},
				"functionSigs": {
					"type": "array",
					"items": {
						"$ref": "#/$defs/FunctionSignature"
					}
				},
				"nodes": {
					"type": "array",
					"items": {
						"anyOf": [
							{
								"type": "object",
								"properties": {
									"type": {
										"$ref": "#/$defs/Type"
									},
									"expr": {
										"$ref": "#/$defs/EirExpr"
									},
									"id": {
										"type": "string"
									}
								},
								"additionalProperties": false,
								"required": [
									"id",
									"expr"
								]
							},
							{
								"type": "object",
								"properties": {
									"type": {
										"$ref": "#/$defs/Type"
									},
									"blocks": {
										"type": "array",
										"items": {
											"type": "object",
											"properties": {
												"id": {
													"type": "string"
												},
												"instructions": {
													"type": "array",
													"items": {
														"anyOf": [
															{
																"anyOf": [
																	{
																		"type": "object",
																		"properties": {
																			"kind": {
																				"type": "string",
																				"const": "assign"
																			},
																			"target": {
																				"type": "string"
																			},
																			"value": {
																				"$ref": "#/$defs/EirExpr"
																			}
																		},
																		"additionalProperties": false,
																		"required": [
																			"kind",
																			"target",
																			"value"
																		]
																	},
																	{
																		"type": "object",
																		"properties": {
																			"args": {
																				"type": "array",
																				"items": {
																					"type": "string"
																				}
																			},
																			"kind": {
																				"type": "string",
																				"const": "op"
																			},
																			"name": {
																				"type": "string"
																			},
																			"ns": {
																				"type": "string"
																			},
																			"target": {
																				"type": "string"
																			}
																		},
																		"additionalProperties": false,
																		"required": [
																			"kind",
																			"target",
																			"ns",
																			"name",
																			"args"
																		]
																	},
																	{
																		"$ref": "#/$defs/LirInsPhi"
																	},
																	{
																		"type": "object",
																		"properties": {
																			"args": {
																				"type": "array",
																				"items": {
																					"type": "string"
																				}
																			},
																			"kind": {
																				"type": "string",
																				"const": "effect"
																			},
																			"op": {
																				"type": "string"
																			},
																			"target": {
																				"type": "string"
																			}
																		},
																		"additionalProperties": false,
																		"required": [
																			"kind",
																			"target",
																			"op",
																			"args"
																		]
																	},
																	{
																		"type": "object",
																		"properties": {
																			"kind": {
																				"type": "string",
																				"const": "assignRef"
																			},
																			"target": {
																				"type": "string"
																			},
																			"value": {
																				"type": "string"
																			}
																		},
																		"additionalProperties": false,
																		"required": [
																			"kind",
																			"target",
																			"value"
																		]
																	}
																]
															},
															{
																"type": "object",
																"properties": {
																	"args": {
																		"type": "array",
																		"items": {
																			"type": "string"
																		}
																	},
																	"entry": {
																		"type": "string"
																	},
																	"kind": {
																		"type": "string",
																		"const": "spawn"
																	},
																	"target": {
																		"type": "string"
																	}
																},
																"additionalProperties": false,
																"required": [
																	"kind",
																	"target",
																	"entry"
																]
															},
															{
																"type": "object",
																"properties": {
																	"channel": {
																		"type": "string"
																	},
																	"kind": {
																		"type": "string",
																		"const": "channelOp"
																	},
																	"op": {
																		"type": "string",
																		"enum": [
																			"send",
																			"recv",
																			"trySend",
																			"tryRecv"
																		]
																	},
																	"target": {
																		"type": "string"
																	},
																	"value": {
																		"type": "string"
																	}
																},
																"additionalProperties": false,
																"required": [
																	"kind",
																	"op",
																	"channel"
																]
															},
															{
																"type": "object",
																"properties": {
																	"future": {
																		"type": "string"
																	},
																	"kind": {
																		"type": "string",
																		"const": "await"
																	},
																	"target": {
																		"type": "string"
																	}
																},
																"additionalProperties": false,
																"required": [
																	"kind",
																	"target",
																	"future"
																]
															}
														]
													}
												},
												"terminator": {
													"anyOf": [
														{
															"$ref": "#/$defs/LirTermJump"
														},
														{
															"$ref": "#/$defs/LirTermBranch"
														},
														{
															"$ref": "#/$defs/LirTermReturn"
														},
														{
															"$ref": "#/$defs/LirTermExit"
														},
														{
															"type": "object",
															"properties": {
																"branches": {
																	"type": "array",
																	"items": {
																		"type": "object",
																		"properties": {
																			"block": {
																				"type": "string"
																			},
																			"taskId": {
																				"type": "string"
																			}
																		},
																		"additionalProperties": false,
																		"required": [
																			"block",
																			"taskId"
																		]
																	}
																},
																"continuation": {
																	"type": "string"
																},
																"kind": {
																	"type": "string",
																	"const": "fork"
																}
															},
															"additionalProperties": false,
															"required": [
																"kind",
																"branches",
																"continuation"
															]
														},
														{
															"type": "object",
															"properties": {
																"kind": {
																	"type": "string",
																	"const": "join"
																},
																"results": {
																	"type": "array",
																	"items": {
																		"type": "string"
																	}
																},
																"tasks": {
																	"type": "array",
																	"items": {
																		"type": "string"
																	}
																},
																"to": {
																	"type": "string"
																}
															},
															"additionalProperties": false,
															"required": [
																"kind",
																"tasks",
																"to"
															]
														},
														{
															"type": "object",
															"properties": {
																"future": {
																	"type": "string"
																},
																"kind": {
																	"type": "string",
																	"const": "suspend"
																},
																"resumeBlock": {
																	"type": "string"
																}
															},
															"additionalProperties": false,
															"required": [
																"kind",
																"future",
																"resumeBlock"
															]
														}
													]
												}
											},
											"additionalProperties": false,
											"required": [
												"id",
												"instructions",
												"terminator"
											]
										}
									},
									"entry": {
										"type": "string"
									},
									"id": {
										"type": "string"
									}
								},
								"additionalProperties": false,
								"required": [
									"id",
									"blocks",
									"entry"
								]
							}
						]
					}
				},
				"result": {
					"type": "string"
				},
				"version": {
					"type": "string",
					"pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$"
				}
			},
			"additionalProperties": false,
			"required": [
				"version",
				"nodes",
				"result"
			]
		},
		{
			"description": "LIRDocument",
			"type": "object",
			"properties": {
				"airDefs": {
					"type": "array",
					"items": {
						"$ref": "#/$defs/AIRDef"
					}
				},
				"capabilities": {
					"type": "array",
					"items": {
						"type": "string"
					}
				},
				"functionSigs": {
					"type": "array",
					"items": {
						"$ref": "#/$defs/FunctionSignature"
					}
				},
				"nodes": {
					"type": "array",
					"items": {
						"anyOf": [
							{
								"type": "object",
								"properties": {
									"type": {
										"$ref": "#/$defs/Type"
									},
									"expr": {
										"anyOf": [
											{
												"$ref": "#/$defs/LitExpr"
											},
											{
												"$ref": "#/$defs/RefExpr"
											},
											{
												"$ref": "#/$defs/VarExpr"
											},
											{
												"$ref": "#/$defs/CallExpr"
											},
											{
												"$ref": "#/$defs/IfExpr"
											},
											{
												"$ref": "#/$defs/LetExpr"
											},
											{
												"$ref": "#/$defs/AirRefExpr"
											},
											{
												"$ref": "#/$defs/PredicateExpr"
											},
											{
												"type": "object",
												"properties": {
													"type": {
														"$ref": "#/$defs/Type"
													},
													"body": {
														"type": "string"
													},
													"kind": {
														"type": "string",
														"const": "lambda"
													},
													"params": {
														"type": "array",
														"items": {
															"anyOf": [
																{
																	"type": "string"
																},
																{
																	"type": "object",
																	"properties": {
																		"type": {
																			"$ref": "#/$defs/Type"
																		},
																		"default": {
																			"$ref": "#/$defs/Expr"
																		},
																		"name": {
																			"type": "string"
																		},
																		"optional": {
																			"type": "boolean"
																		}
																	},
																	"additionalProperties": false,
																	"required": [
																		"name"
																	]
																}
															]
														}
													}
												},
												"additionalProperties": false,
												"required": [
													"kind",
													"params",
													"body",
													"type"
												]
											},
											{
												"type": "object",
												"properties": {
													"args": {
														"type": "array",
														"items": {
															"anyOf": [
																{
																	"type": "string"
																},
																{
																	"$ref": "#/$defs/Expr"
																}
															]
														}
													},
													"fn": {
														"type": "string"
													},
													"kind": {
														"type": "string",
														"const": "callExpr"
													}
												},
												"additionalProperties": false,
												"required": [
													"kind",
													"fn",
													"args"
												]
											},
											{
												"type": "object",
												"properties": {
													"type": {
														"$ref": "#/$defs/Type"
													},
													"fn": {
														"type": "string"
													},
													"kind": {
														"type": "string",
														"const": "fix"
													}
												},
												"additionalProperties": false,
												"required": [
													"kind",
													"fn",
													"type"
												]
											},
											{
												"type": "object",
												"properties": {
													"exprs": {
														"type": "array",
														"items": {
															"anyOf": [
																{
																	"type": "string"
																},
																{
																	"$ref": "#/$defs/Expr"
																}
															]
														}
													},
													"kind": {
														"type": "string",
														"const": "do"
													}
												},
												"additionalProperties": false,
												"required": [
													"kind",
													"exprs"
												]
											}
										]
									},
									"id": {
										"type": "string"
									}
								},
								"additionalProperties": false,
								"required": [
									"id",
									"expr"
								]
							},
							{
								"type": "object",
								"properties": {
									"type": {
										"$ref": "#/$defs/Type"
									},
									"blocks": {
										"type": "array",
										"items": {
											"type": "object",
											"properties": {
												"id": {
													"type": "string"
												},
												"instructions": {
													"type": "array",
													"items": {
														"anyOf": [
															{
																"$ref": "#/$defs/LirInsAssign"
															},
															{
																"type": "object",
																"properties": {
																	"args": {
																		"type": "array",
																		"items": {
																			"type": "string"
																		}
																	},
																	"callee": {
																		"type": "string"
																	},
																	"kind": {
																		"type": "string",
																		"const": "call"
																	},
																	"target": {
																		"type": "string"
																	}
																},
																"additionalProperties": false,
																"required": [
																	"kind",
																	"target",
																	"callee",
																	"args"
																]
															},
															{
																"$ref": "#/$defs/LirInsOp"
															},
															{
																"$ref": "#/$defs/LirInsPhi"
															},
															{
																"type": "object",
																"properties": {
																	"args": {
																		"type": "array",
																		"items": {
																			"type": "string"
																		}
																	},
																	"kind": {
																		"type": "string",
																		"const": "effect"
																	},
																	"op": {
																		"type": "string"
																	},
																	"target": {
																		"type": "string"
																	}
																},
																"additionalProperties": false,
																"required": [
																	"kind",
																	"op",
																	"args"
																]
															},
															{
																"type": "object",
																"properties": {
																	"kind": {
																		"type": "string",
																		"const": "assignRef"
																	},
																	"target": {
																		"type": "string"
																	},
																	"value": {
																		"type": "string"
																	}
																},
																"additionalProperties": false,
																"required": [
																	"kind",
																	"target",
																	"value"
																]
															}
														]
													}
												},
												"terminator": {
													"anyOf": [
														{
															"$ref": "#/$defs/LirTermJump"
														},
														{
															"$ref": "#/$defs/LirTermBranch"
														},
														{
															"$ref": "#/$defs/LirTermReturn"
														},
														{
															"$ref": "#/$defs/LirTermExit"
														},
														{
															"type": "object",
															"properties": {
																"branches": {
																	"type": "array",
																	"items": {
																		"type": "object",
																		"properties": {
																			"block": {
																				"type": "string"
																			},
																			"taskId": {
																				"type": "string"
																			}
																		},
																		"additionalProperties": false,
																		"required": [
																			"block",
																			"taskId"
																		]
																	}
																},
																"continuation": {
																	"type": "string"
																},
																"kind": {
																	"type": "string",
																	"const": "fork"
																}
															},
															"additionalProperties": false,
															"required": [
																"kind",
																"branches",
																"continuation"
															]
														},
														{
															"type": "object",
															"properties": {
																"kind": {
																	"type": "string",
																	"const": "join"
																},
																"results": {
																	"type": "array",
																	"items": {
																		"type": "string"
																	}
																},
																"tasks": {
																	"type": "array",
																	"items": {
																		"type": "string"
																	}
																},
																"to": {
																	"type": "string"
																}
															},
															"additionalProperties": false,
															"required": [
																"kind",
																"tasks",
																"to"
															]
														},
														{
															"type": "object",
															"properties": {
																"future": {
																	"type": "string"
																},
																"kind": {
																	"type": "string",
																	"const": "suspend"
																},
																"resumeBlock": {
																	"type": "string"
																}
															},
															"additionalProperties": false,
															"required": [
																"kind",
																"future",
																"resumeBlock"
															]
														}
													]
												}
											},
											"additionalProperties": false,
											"required": [
												"id",
												"instructions",
												"terminator"
											]
										}
									},
									"entry": {
										"type": "string"
									},
									"id": {
										"type": "string"
									}
								},
								"additionalProperties": false,
								"required": [
									"id",
									"blocks",
									"entry"
								]
							}
						]
					}
				},
				"result": {
					"type": "string"
				},
				"version": {
					"type": "string",
					"pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$"
				}
			},
			"additionalProperties": false,
			"required": [
				"version",
				"nodes",
				"result"
			]
		}
	]
}
