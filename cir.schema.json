{
	"$schema": "https://json-schema.org/draft/2020-12/schema",
	"$id": "https://raw.githubusercontent.com/Mearman/SPIRAL/refs/heads/main/cir.schema.json",
	"title": "CIR Document",
	"description": "CIRDocument",
	"type": "object",
	"properties": {
		"$defs": {
			"type": "object",
			"additionalProperties": {
				"$ref": "spiral.schema.json#/$defs/Def"
			},
			"propertyNames": {
				"type": "string"
			}
		},
		"$imports": {
			"type": "object",
			"additionalProperties": {
				"$ref": "spiral.schema.json#/$defs/ImportEntry"
			},
			"propertyNames": {
				"type": "string"
			}
		},
		"airDefs": {
			"type": "array",
			"items": {
				"$ref": "spiral.schema.json#/$defs/AIRDef"
			}
		},
		"capabilities": {
			"type": "array",
			"items": {
				"type": "string"
			}
		},
		"functionSigs": {
			"type": "array",
			"items": {
				"$ref": "spiral.schema.json#/$defs/FunctionSignature"
			}
		},
		"nodes": {
			"type": "array",
			"items": {
				"anyOf": [
					{
						"type": "object",
						"properties": {
							"type": {
								"$ref": "spiral.schema.json#/$defs/Type"
							},
							"expr": {
								"$ref": "spiral.schema.json#/$defs/CirExpr"
							},
							"id": {
								"type": "string"
							}
						},
						"additionalProperties": false,
						"required": [
							"id",
							"expr"
						]
					},
					{
						"$ref": "spiral.schema.json#/$defs/RefNode"
					},
					{
						"type": "object",
						"properties": {
							"type": {
								"$ref": "spiral.schema.json#/$defs/Type"
							},
							"blocks": {
								"type": "array",
								"items": {
									"type": "object",
									"properties": {
										"id": {
											"type": "string"
										},
										"instructions": {
											"type": "array",
											"items": {
												"anyOf": [
													{
														"type": "object",
														"properties": {
															"kind": {
																"type": "string",
																"const": "assign"
															},
															"target": {
																"type": "string"
															},
															"value": {
																"$ref": "spiral.schema.json#/$defs/CirExpr"
															}
														},
														"additionalProperties": false,
														"required": [
															"kind",
															"target",
															"value"
														]
													},
													{
														"type": "object",
														"properties": {
															"args": {
																"type": "array",
																"items": {
																	"type": "string"
																}
															},
															"kind": {
																"type": "string",
																"const": "op"
															},
															"name": {
																"type": "string"
															},
															"ns": {
																"type": "string"
															},
															"target": {
																"type": "string"
															}
														},
														"additionalProperties": false,
														"required": [
															"kind",
															"target",
															"ns",
															"name",
															"args"
														]
													},
													{
														"$ref": "spiral.schema.json#/$defs/LirInsPhi"
													}
												]
											}
										},
										"terminator": {
											"$ref": "spiral.schema.json#/$defs/LirTerminator"
										}
									},
									"additionalProperties": false,
									"required": [
										"id",
										"instructions",
										"terminator"
									]
								}
							},
							"entry": {
								"type": "string"
							},
							"id": {
								"type": "string"
							}
						},
						"additionalProperties": false,
						"required": [
							"id",
							"blocks",
							"entry"
						]
					}
				]
			}
		},
		"result": {
			"type": "string"
		},
		"version": {
			"type": "string",
			"pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$"
		}
	},
	"additionalProperties": false,
	"required": [
		"version",
		"airDefs",
		"nodes",
		"result"
	],
	"id": "CIRDocument"
}
