{
	"$schema": "https://raw.githubusercontent.com/Mearman/SPIRAL/main/cir.schema.json",
	"version": "1.0.0",
	"description": "Meta-evaluation of a CIR program using let and match: constructs 'let x = \"hello\" in match x { \"hello\" -> 1, \"world\" -> 2, default -> 0 }' as data, then passes it to meta:eval. Expected result: 1.",
	"airDefs": [],
	"nodes": [
		{"id": "s_lit",      "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "lit"}},
		{"id": "s_var",      "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "var"}},
		{"id": "s_let",      "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "let"}},
		{"id": "s_match",    "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "match"}},
		{"id": "s_string",   "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "string"}},
		{"id": "s_int",      "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "int"}},

		{"id": "s_kind",     "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "kind"}},
		{"id": "s_type",     "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "type"}},
		{"id": "s_value",    "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "value"}},
		{"id": "s_name",     "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "name"}},
		{"id": "s_cases",    "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "cases"}},
		{"id": "s_pattern",  "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "pattern"}},
		{"id": "s_body",     "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "body"}},
		{"id": "s_default",  "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "default"}},
		{"id": "s_id",       "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "id"}},
		{"id": "s_expr",     "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "expr"}},

		{"id": "s_helloLit",   "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "helloLit"}},
		{"id": "s_zero",       "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "zero"}},
		{"id": "s_one",        "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "one"}},
		{"id": "s_two",        "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "two"}},
		{"id": "s_xVar",       "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "xVar"}},
		{"id": "s_matchExpr",  "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "matchExpr"}},
		{"id": "s_result",     "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "result"}},

		{"id": "s_hello",   "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "hello"}},
		{"id": "s_world",   "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "world"}},
		{"id": "s_x",       "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "x"}},
		{"id": "s_1_0_0",   "expr": {"kind": "lit", "type": {"kind": "string"}, "value": "1.0.0"}},

		{"id": "v_zero", "expr": {"kind": "lit", "type": {"kind": "int"}, "value": 0}},
		{"id": "v_one",  "expr": {"kind": "lit", "type": {"kind": "int"}, "value": 1}},
		{"id": "v_two",  "expr": {"kind": "lit", "type": {"kind": "int"}, "value": 2}},

		{"id": "typeString", "expr": {"kind": "record", "fields": [{"key": "kind", "value": "s_string"}]}},
		{"id": "typeInt",    "expr": {"kind": "record", "fields": [{"key": "kind", "value": "s_int"}]}},

		{"id": "e_helloLit", "expr": {"kind": "record", "fields": [
			{"key": "kind", "value": "s_lit"},
			{"key": "type", "value": "typeString"},
			{"key": "value", "value": "s_hello"}
		]}},
		{"id": "n_helloLit", "expr": {"kind": "record", "fields": [
			{"key": "id", "value": "s_helloLit"},
			{"key": "expr", "value": "e_helloLit"}
		]}},

		{"id": "e_zero", "expr": {"kind": "record", "fields": [
			{"key": "kind", "value": "s_lit"},
			{"key": "type", "value": "typeInt"},
			{"key": "value", "value": "v_zero"}
		]}},
		{"id": "n_zero", "expr": {"kind": "record", "fields": [
			{"key": "id", "value": "s_zero"},
			{"key": "expr", "value": "e_zero"}
		]}},

		{"id": "e_one", "expr": {"kind": "record", "fields": [
			{"key": "kind", "value": "s_lit"},
			{"key": "type", "value": "typeInt"},
			{"key": "value", "value": "v_one"}
		]}},
		{"id": "n_one", "expr": {"kind": "record", "fields": [
			{"key": "id", "value": "s_one"},
			{"key": "expr", "value": "e_one"}
		]}},

		{"id": "e_two", "expr": {"kind": "record", "fields": [
			{"key": "kind", "value": "s_lit"},
			{"key": "type", "value": "typeInt"},
			{"key": "value", "value": "v_two"}
		]}},
		{"id": "n_two", "expr": {"kind": "record", "fields": [
			{"key": "id", "value": "s_two"},
			{"key": "expr", "value": "e_two"}
		]}},

		{"id": "e_xVar", "expr": {"kind": "record", "fields": [
			{"key": "kind", "value": "s_var"},
			{"key": "name", "value": "s_x"}
		]}},
		{"id": "n_xVar", "expr": {"kind": "record", "fields": [
			{"key": "id", "value": "s_xVar"},
			{"key": "expr", "value": "e_xVar"}
		]}},

		{"id": "case1", "expr": {"kind": "record", "fields": [
			{"key": "pattern", "value": "s_hello"},
			{"key": "body", "value": "s_one"}
		]}},
		{"id": "case2", "expr": {"kind": "record", "fields": [
			{"key": "pattern", "value": "s_world"},
			{"key": "body", "value": "s_two"}
		]}},
		{"id": "casesList", "expr": {"kind": "listOf", "elements": ["case1", "case2"]}},

		{"id": "e_matchExpr", "expr": {"kind": "record", "fields": [
			{"key": "kind", "value": "s_match"},
			{"key": "value", "value": "s_xVar"},
			{"key": "cases", "value": "casesList"},
			{"key": "default", "value": "s_zero"}
		]}},
		{"id": "n_matchExpr", "expr": {"kind": "record", "fields": [
			{"key": "id", "value": "s_matchExpr"},
			{"key": "expr", "value": "e_matchExpr"}
		]}},

		{"id": "e_result", "expr": {"kind": "record", "fields": [
			{"key": "kind", "value": "s_let"},
			{"key": "name", "value": "s_x"},
			{"key": "value", "value": "s_helloLit"},
			{"key": "body", "value": "s_matchExpr"}
		]}},
		{"id": "n_result", "expr": {"kind": "record", "fields": [
			{"key": "id", "value": "s_result"},
			{"key": "expr", "value": "e_result"}
		]}},

		{"id": "innerNodes", "expr": {"kind": "listOf", "elements": [
			"n_helloLit", "n_zero", "n_one", "n_two",
			"n_xVar", "n_matchExpr", "n_result"
		]}},

		{"id": "emptyAirDefs", "expr": {"kind": "listOf", "elements": []}},

		{"id": "document", "expr": {"kind": "record", "fields": [
			{"key": "version", "value": "s_1_0_0"},
			{"key": "airDefs", "value": "emptyAirDefs"},
			{"key": "nodes", "value": "innerNodes"},
			{"key": "result", "value": "s_result"}
		]}},

		{"id": "result", "expr": {"kind": "call", "ns": "meta", "name": "eval", "args": ["document"]}}
	],
	"result": "result",
	"expected_result": 1
}
