{
	"$schema": "https://json-schema.org/draft/2020-12/schema",
	"$id": "https://raw.githubusercontent.com/Mearman/SPIRAL/refs/heads/main/air.schema.json",
	"title": "AIR (Algebraic IR)",
	"description": "AIRDocument",
	"type": "object",
	"properties": {
		"airDefs": {
			"type": "array",
			"items": {
				"$ref": "spiral.schema.json#/$defs/AIRDef"
			}
		},
		"capabilities": {
			"type": "array",
			"items": {
				"type": "string"
			}
		},
		"functionSigs": {
			"type": "array",
			"items": {
				"$ref": "spiral.schema.json#/$defs/FunctionSignature"
			}
		},
		"nodes": {
			"type": "array",
			"items": {
				"anyOf": [
					{
						"type": "object",
						"properties": {
							"type": {
								"$ref": "spiral.schema.json#/$defs/Type"
							},
							"expr": {
								"anyOf": [
									{
										"$ref": "spiral.schema.json#/$defs/LitExpr"
									},
									{
										"$ref": "spiral.schema.json#/$defs/RefExpr"
									},
									{
										"$ref": "spiral.schema.json#/$defs/VarExpr"
									},
									{
										"$ref": "spiral.schema.json#/$defs/CallExpr"
									},
									{
										"$ref": "spiral.schema.json#/$defs/IfExpr"
									},
									{
										"$ref": "spiral.schema.json#/$defs/LetExpr"
									},
									{
										"$ref": "spiral.schema.json#/$defs/AirRefExpr"
									},
									{
										"$ref": "spiral.schema.json#/$defs/PredicateExpr"
									}
								]
							},
							"id": {
								"type": "string"
							}
						},
						"additionalProperties": false,
						"required": [
							"id",
							"expr"
						]
					},
					{
						"type": "object",
						"properties": {
							"type": {
								"$ref": "spiral.schema.json#/$defs/Type"
							},
							"blocks": {
								"type": "array",
								"items": {
									"type": "object",
									"properties": {
										"id": {
											"type": "string"
										},
										"instructions": {
											"type": "array",
											"items": {
												"anyOf": [
													{
														"type": "object",
														"properties": {
															"kind": {
																"type": "string",
																"const": "assign"
															},
															"target": {
																"type": "string"
															},
															"value": {
																"anyOf": [
																	{
																		"$ref": "spiral.schema.json#/$defs/LitExpr"
																	},
																	{
																		"$ref": "spiral.schema.json#/$defs/RefExpr"
																	},
																	{
																		"$ref": "spiral.schema.json#/$defs/VarExpr"
																	},
																	{
																		"$ref": "spiral.schema.json#/$defs/CallExpr"
																	},
																	{
																		"$ref": "spiral.schema.json#/$defs/IfExpr"
																	},
																	{
																		"$ref": "spiral.schema.json#/$defs/LetExpr"
																	},
																	{
																		"$ref": "spiral.schema.json#/$defs/AirRefExpr"
																	},
																	{
																		"$ref": "spiral.schema.json#/$defs/PredicateExpr"
																	}
																]
															}
														},
														"additionalProperties": false,
														"required": [
															"kind",
															"target",
															"value"
														]
													},
													{
														"type": "object",
														"properties": {
															"args": {
																"type": "array",
																"items": {
																	"type": "string"
																}
															},
															"kind": {
																"type": "string",
																"const": "op"
															},
															"name": {
																"type": "string"
															},
															"ns": {
																"type": "string"
															},
															"target": {
																"type": "string"
															}
														},
														"additionalProperties": false,
														"required": [
															"kind",
															"target",
															"ns",
															"name",
															"args"
														]
													},
													{
														"$ref": "spiral.schema.json#/$defs/LirInsPhi"
													}
												]
											}
										},
										"terminator": {
											"anyOf": [
												{
													"$ref": "spiral.schema.json#/$defs/LirTermJump"
												},
												{
													"$ref": "spiral.schema.json#/$defs/LirTermBranch"
												},
												{
													"$ref": "spiral.schema.json#/$defs/LirTermReturn"
												},
												{
													"$ref": "spiral.schema.json#/$defs/LirTermExit"
												}
											]
										}
									},
									"additionalProperties": false,
									"required": [
										"id",
										"instructions",
										"terminator"
									]
								}
							},
							"entry": {
								"type": "string"
							},
							"id": {
								"type": "string"
							}
						},
						"additionalProperties": false,
						"required": [
							"id",
							"blocks",
							"entry"
						]
					}
				]
			}
		},
		"result": {
			"type": "string"
		},
		"version": {
			"type": "string",
			"pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$"
		}
	},
	"additionalProperties": false,
	"required": [
		"version",
		"airDefs",
		"nodes",
		"result"
	]
}
